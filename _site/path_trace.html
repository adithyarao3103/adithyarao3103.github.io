<html>
<head>
    <title>Path Tracer</title>
    <meta charset="utf-8">
    <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
</head>


<style>


    #controls{
        flex: 25%;
        padding: 30px;
    }


    #plot{
        flex: 75%;
    }
    
    #parent{
        width:95vw;
        height:95vh;
        display: flex;
    }
</style>

<body>

    <div id="parent">

    <div id="controls">
        <label for="qe">qe:</label><input type="text" id="qe" name="qe" value="0"><br>
        <label for="qm">qm:</label><input type="text" id="qm" name="qm" value="0"><br>
        <label for="vx">vx:</label><input type="text" id="vx" name="vx" value="0"><br>
        <label for="vy">vy:</label><input type="text" id="vy" name="vy" value="0"><br>
        <label for="vz">vz:</label><input type="text" id="vz" name="vz" value="0"><br>
        <label for="Ex">Ex:</label><input type="text" id="Ex" name="Ex" value="0"><br>
        <label for="Ey">Ey:</label><input type="text" id="Ey" name="Ey" value="0"><br>
        <label for="Ez">Ez:</label><input type="text" id="Ez" name="Ez" value="0"><br>
        <label for="Bx">Bx:</label><input type="text" id="Bx" name="Bx" value="0"><br>
        <label for="By">By:</label><input type="text" id="By" name="By" value="0"><br>
        <label for="Bz">Bz:</label><input type="text" id="Bz" name="Bz" value="0"><br>
        <label for="precision">precision:</label><input type="text" id="precision" name="precision" value="0"><br>
        <label for="time">time:</label><input type="text" id="time" name="time" value="0"><br>
        <button onclick="plot()">Trace Path</button>
    </div><div id="plot"></div>

    </div>

</body>

<script>

function plot(){
qe = parseFloat(document.getElementById("qe").value);
qm = parseFloat(document.getElementById("qm").value);
v = [parseFloat(document.getElementById("vx").value), parseFloat(document.getElementById("vy").value), parseFloat(document.getElementById("vz").value)];
B = [parseFloat(document.getElementById("Bx").value), parseFloat(document.getElementById("By").value), parseFloat(document.getElementById("Bz").value)];
E = [parseFloat(document.getElementById("Ex").value), parseFloat(document.getElementById("Ey").value), parseFloat(document.getElementById("Ez").value)];
r = [0,0,0];
F = [0,0,0];
rx = [];
ry = [];
rz = [];
precision = parseFloat(document.getElementById("precision").value);
time = parseFloat(document.getElementById("time").value);

console.log(qe, qm, v, B, E, precision, time);

track_path();
}


    function cross(v1, v2){
        v3 = [];
        v3[0] = (v1[1]*v2[2] - v1[2]*v2[1]);
        v3[1] = (v2[0]*v1[2] - v1[0]*v2[2]);
        v3[2] = (v1[0]*v2[1] - v1[1]*v2[0]);
        return(v3);
    }

    function plot_in_ly(x,y,z){

  Plotly.newPlot('plot', [{
  type: 'scatter3d',
  mode: 'lines',
  x: x,
  y: y,
  z: z,
  opacity: 1,
  line: {
    width: 6,
    color: 1,
    reversescale: false
  }
}],{
    autosize: true,
    automargin: true
}, {
    responsive: true
});
};

function track_path(){
    for(i = 0; i<=time; i+=precision){
        vB = cross(v, B);
        vE = cross(v, E);
        for(j = 0; j<3; j++){
            F[j] = qe*(E[j] + vB[j]) + qm*(B[j] - vE[j]);
            v[j] = v[j] + F[j]*precision;
            r[j] = r[j] + v[j]*precision;
        }
        rx.push(r[0]);
        ry.push(r[1]);
        rz.push(r[2]);
    }

    console.log(rx, ry, rz);

    plot_in_ly(rx,ry,rz);
}



</script>



</html>